name: example-basic-pnpm
on:
  push:
    branches:
      - 'master'
  pull_request:
  workflow_dispatch:

jobs:
  # ~~~~~~~~~~~~~~~~~~ Cypress v9 and below (using Legacy configuration) ~~~~~~~~~~~~~~~~~~~ #

  # basic-pnpm-ubuntu-20-v9:
  #   runs-on: ubuntu-20.04
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 7

  #     - name: Cypress tests
  #       # normally you would write
  #       # uses: cypress-io/github-action@v5
  #       uses: ./
  #       # the parameters below are only necessary
  #       # because we are running these examples in a monorepo
  #       with:
  #         working-directory: examples/v9/basic-pnpm
  #         # just for full picture after installing Cypress
  #         # print information about detected browsers, etc
  #         # see https://on.cypress.io/command-line#cypress-info
  #         build: npx cypress info

  # basic-pnpm-ubuntu-22-v9:
  #   runs-on: ubuntu-22.04
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 7

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/v9/basic-pnpm
  #         build: npx cypress info

  # basic-pnpm-on-windows-v9:
  #   runs-on: windows-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 7

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/v9/basic-pnpm
  #         build: npx cypress info

  # basic-pnpm-on-mac-v9:
  #   runs-on: macos-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 7

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/v9/basic-pnpm
  #         build: npx cypress info

  # # skips the binary installation
  # # shows that the job should not fail
  # # https://github.com/cypress-io/github-action/issues/327
  # basic-pnpm-without-binary-install-v9:
  #   runs-on: ubuntu-22.04
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 7

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/v9/basic-pnpm
  #         # since we do not install Cypress
  #         # we should not attempt to run tests
  #         runTests: false
  #       env:
  #         # skip the binary install
  #         CYPRESS_INSTALL_BINARY: 0

  # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Cypress v10 and higher ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

  basic-pnpm-ubuntu-22:
    runs-on: ubuntu-22.04
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Cypress install
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          runTests: false
        env:
          DEBUG: '@cypress/github-action'

      - name: id
        run: id

      - name: Cypress infos
        run: |
          npx cypress verify
          npx cypress info
        working-directory: examples/basic-pnpm
      - run: echo $HOME
      - name: home
        run: ls -al /home

      - name: /home/runner
        run: ls -al /home/runner

      - name: /home/runner/.cache
        run: ls -al /home/runner/.cache

      - name: Cypress tests
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          install: false
        env:
          DEBUG: '@cypress/github-action'

  basic-pnpm-ubuntu-22-docker:
    runs-on: ubuntu-22.04
    container: cypress/browsers:node16.16.0-chrome107-ff107
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Cypress install
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          runTests: false
        env:
          DEBUG: '@cypress/github-action'

      - name: id
        run: id

      - name: Cypress infos
        run: |
          npx cypress verify
          npx cypress info
        working-directory: examples/basic-pnpm
      - run: echo $HOME
      - name: github
        run: ls -al /github

      - name: github/home
        run: ls -al /github/home

      - name: /github/home/.cache
        run: ls -al /github/home/.cache

      - name: Cypress tests
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          install: false
        env:
          DEBUG: '@cypress/github-action'

  basic-pnpm-ubuntu-22-docker-latest:
    runs-on: ubuntu-22.04
    container: cypress/browsers:latest
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Cypress install
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          runTests: false
        env:
          DEBUG: '@cypress/github-action'

      - name: id
        run: id

      - name: Cypress infos
        run: |
          npx cypress verify
          npx cypress info
        working-directory: examples/basic-pnpm
      - run: echo $HOME
      - name: github
        run: ls -al /github

      - name: github/home
        run: ls -al /github/home

      - name: /github/home/.cache
        run: ls -al /github/home/.cache

      - name: Cypress tests
        uses: ./
        with:
          working-directory: examples/basic-pnpm
          install: false
        env:
          DEBUG: '@cypress/github-action'

  # basic-pnpm-on-mac:
  #   runs-on: macos-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 8

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/basic-pnpm
  #         build: npx cypress info

  # # skips the binary installation
  # # shows that the job should not fail
  # # https://github.com/cypress-io/github-action/issues/327
  # basic-pnpm-without-binary-install:
  #   runs-on: ubuntu-22.04
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Install pnpm
  #       uses: pnpm/action-setup@v2
  #       with:
  #         version: 8

  #     - name: Cypress tests
  #       uses: ./
  #       with:
  #         working-directory: examples/basic-pnpm
  #         # since we do not install Cypress
  #         # we should not attempt to run tests
  #         runTests: false
  #       env:
  #         # skip the binary install
  #         CYPRESS_INSTALL_BINARY: 0
